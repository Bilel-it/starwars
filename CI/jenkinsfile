pipeline {    
    options { skipDefaultCheckout() }
    agent {label 'jenkinsmaster'}  
    stages {
    
    
    
    
    stage('Tag') {
            
         
         steps{
    script {
     
     
     GIT_COMMIT_HASH = sh (
    script: "git log -n 1 --pretty=format:'%H'",
    returnStdout: true
).trim()   
     
               

                echo "**************************************************"
                echo "bilel ${GIT_COMMIT_HASH}"
                echo "**************************************************"
                
                
                
    }
}
       
                  
            

        }
    
    
    
    
    
    
        stage('BUILD & Push Image') {
            steps{
                checkout scm
                
                front = "frontend:${GIT_COMMIT_HASH}"
                echo "${front}"

                echo "#################### Build  frontend  #################"
                sh '''  
                        docker build -t "${front}" FE
                       

                '''
                echo "#################### Tag & Push Image ms-frontend to azurecr.io #################"
                sh '''  
                        
                        docker tag frontend:1.1-4 imagedockerpaas.azurecr.io/"${front}"
                        docker push imagedockerpaas.azurecr.io/"${front}"

                '''

back = "backend:${GIT_COMMIT_HASH}"
                echo "${back}"


                echo "#################################"
                echo "#################### backend #################"
                sh '''  
                        docker build -t "${back}" BE
                        
                '''
                echo "#################### Tag & Push Image products #################"
                sh '''  
                        docker tag backend:1.1-4 imagedockerpaas.azurecr.io/"${back}"
                        docker push imagedockerpaas.azurecr.io/"${back}"
                '''
               
                

                

                
            } 
        } 
        
    }
        
}
